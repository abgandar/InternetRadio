<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="utf-8">
    <title>Internet Radio</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- doesn't work with HTTP auth
    <link rel="manifest" href="klingel.json">
    <meta name="mobile-web-app-capable" content="yes"> -->
    <link rel="icon" href="klingel-0-75x.png" size="32x32">
    <link rel="icon" href="klingel-1x.png" size="48x48">
    <link rel="icon" href="klingel-2x.png" size="96x96">
    <link rel="icon" href="klingel-2-6x.png" size="128x128">
    <link rel="icon" href="klingel-4x.png" size="192x192">
    <link rel="icon" href="klingel-5-3x.png" size="256x256">
    <link rel="apple-touch-icon" sizes="128x128" href="klingel-2-6x.png">
<!-- Klingel icon by Babasse (Sebastien Durel)
     Creative Commons Attribution-Noncommercial-No Derivate Works 3.0 Unported
     http://icon-icons.com/de/symbol/Alarm-Glocke/20783   -->
    <style>
      body { font-family: Helvetica Neue, Helvetica, Arial, sans;
        -webkit-touch-callout: none; /* iOS Safari */
          -webkit-user-select: none; /* Chrome/Safari/Opera */
           -khtml-user-select: none; /* Konqueror */
             -moz-user-select: none; /* Firefox */
              -ms-user-select: none; /* Internet Explorer/Edge */
                  user-select: none; /* Non-prefixed version */ }
      #container { position: fixed; top: 0px; left: 0px; height: 100%; width: 100%; overflow: hidden; padding: 0px; margin: 0px; }

      #sidebar { z-index: 10; position: absolute; left: -260px; width: 300px; transition: left 300ms; -webkit-transition: left 300ms; margin: 0px; padding: 0px; }
      #sidebar.aktiv { left: 0%; }
      #sidebar li { border: 1px solid black; font-size: 20pt; display: block; background: #DDDDDD; white-space: nowrap; }
      #sidebar a { margin: 0px; padding: 15px 5px; display: block; text-decoration: none; color: black; text-align: right; }
      #pause-li.play { background: green; }
      #pause-li.play #stop { display: none; }
      #pause-li.stop { background: red; }
      #pause-li.stop #start { display: none; }

      #sender { position: absolute; bottom: 0px; left: 0px; right: 0px; height: 100%; overflow-x: hidden; overflow-y: scroll; padding: 0px; margin: 0px; box-sizing: border-box; }
      #sender li { border: 1px solid black; width: 100%; box-sizing: border-box; display: block; padding: 0px; }
      #sender li a { margin: 0px; padding-top: 30px; padding-bottom: 30px; padding-left: 45px; padding-right: 10px; display: block; text-decoration: none; color: black; font-size: 16pt; box-sizing: border-box; }
      #sender li.aktiv { background: lightblue; border-width: 2px; }
    </style>
    <script type="text/javascript">
      DEFAULT_PLAYLIST = 'Radio';

      function updateState( state )
      {
        var id = state.song ? response.state.song.position : 0;

        document.getElementById('sender').children[id].className = "aktiv";
        document.getElementById('pause-li').className = state.playing ? 'stop' : 'play';
      }

      function populateQueue( )
      {
        // if the queu is empty, populate it with the default playlist now
        if( this.response.playlist.length == 0 )
            loadPlaylist( DEFAULT_PLAYLIST );

        var list = document.getElementById('sender');

        // remove previous entries
        while( list.firstChild ) list.removeChild( list.firstChild );

        // add new entries
        for( var i = 0; i < this.response.playlist.length; i++ )
        {
            var li = document.createElement( 'li' );
            var a = document.createElement('a');
            a.href = "javascript:play("+i+");";
            var text = document.createTextNode(this.response.playlist[i].name);
            a.appendChild(text);
            li.appendChild(a);
            list.appendChild(li);
        }

        updateState( this.response.state );
      }

      function populatePlaylists( )
      {
        var list = document.getElementById('sidebar');

        // remove previous entries
        var old = list.getElementsByClassName('playlist');
        while( old[0] ) list.removeChild( old[0] );

        // add new entries
        for( var i = 0; i < this.response.playlists.length; i++ )
        {
            var li = document.createElement( 'li' );
            li.className = 'playlist';
            var a = document.createElement('a');
            a.href = "javascript:loadPlaylist('"+this.response.playlists[i].name+"');";
            var text = document.createTextNode(this.response.playlists[i].name);
            a.appendChild(text);
            li.appendChild(a);
            list.appendChild(li);
        }

        updateState( this.response.state );
      }

      function refreshQueue( )
      {
        // send request to server
        var url = "http://"+location.host+"/cgi-bin/ir.cgi?queue";
        var xhr = new XMLHttpRequest( );
        xhr.addEventListener( 'load',  populateQueue );
        xhr.responseType = 'json';
        xhr.open( 'GET', url, true );
        xhr.send( );
      }

      function loadPlaylist( name )
      {
        // send request to server
        var url = "http://"+location.host+"/cgi-bin/ir.cgi?"+encodeURIComponent( "load:"+name );
        var xhr = new XMLHttpRequest( );
        xhr.addEventListener( 'load',  populateQueue );
        xhr.responseType = 'json';
        xhr.open( 'GET', url, true );
        xhr.send( );
      }

      function refreshPlaylists( )
      {
        // send request to server
        var url = "http://"+location.host+"/cgi-bin/ir.cgi?playlists";
        var xhr = new XMLHttpRequest( );
        xhr.addEventListener( 'load',  populatePlaylists );
        xhr.responseType = 'json';
        xhr.open( 'GET', url, true );
        xhr.send( );
      }

      function refresh( )
      {
        refreshPlaylists( );
        refreshQueue( );
      }

      function play( nr )
      {
        var ch = document.getElementById('sender').children;

        // if we're already playing the right song this is a no-op
        if( ch[nr].classList.contains('aktiv') && document.getElementById('pause-li').className == 'stop' )
            return;

        // deselect old songs, and highlight new
        for( i = 0; i < ch.length; i++ )
            ch[i].classList.remove('aktiv');
        ch[nr].classList.add('aktiv');

        // send request to server
        var url = "http://"+location.host+"/cgi-bin/ir.cgi?"+encodeURIComponent( "play:"+nr );
        var xhr = new XMLHttpRequest( );
        xhr.addEventListener( 'load',  function( ) { updateState( this.response.state ); } );
//        xhr.addEventListener( 'error', function( ) { cell.className = "error";   setTimeout( function( ) { cell.className = ""; }, 250 ); } );
        xhr.responseType = 'json';
        xhr.open( 'GET', url, true );
        xhr.send( );
      }

      function pause( )
      {
        // Pause or unpause. If we're stopped, start playing at the selected song
        // find selected song
        var nr = -1;
        var ch = document.getElementById('sender').children;
        for( i = 0; i < ch.length; i++ )
            if( ch[i].classList.contains('aktiv') )
            {
                nr = i;
                break;
            }

        // send request to server
        var url = "http://"+location.host+"/cgi-bin/ir.cgi?"+encodeURIComponent( "pause:"+i );
        var xhr = new XMLHttpRequest( );
        xhr.addEventListener( 'load',  function( ) { updateState( this.response.state ); } );
        xhr.responseType = 'json';
        xhr.open( 'GET', url, true );
        xhr.send( );
      }

      function toggleMenu()
      {
        document.getElementById('sidebar').classList.toggle('aktiv');
      }
    </script>
  </head>
  <body onload="refresh()">
    <div id="container">
    <ul id="sidebar">
      <li id="menu-li"><a id="menu" href="javascript:toggleMenu()">Internet Radio &nbsp;&nbsp; &#9776;</a></li>
      <li id="pause-li" class="play">
        <a id="start" href="javascript:pause( )">Abspielen &nbsp;&nbsp; &#x25b6;</a>
        <a id="stop" href="javascript:pause( )">Pause &nbsp;&nbsp; &#x23f8;</a>
      </li>
      <li id="laden-li"><a id="laden" href="javascript:refresh()">Aktualisieren &nbsp;&nbsp; &#x21BB;</a></li>
    </ul>
    <ul id="sender">
    </ul>
    </div>
  </body>
</html>
